%h1
  %small Details for
  = @resource.name

= link_to "Sync now", sync_path(@resource.username), class: "btn btn-primary #{@resource.currently_syncing? ? 'disabled' : ''}"
= link_to "Sync test", sync_path(@resource.username, test: 1), class: "btn btn-default #{@resource.currently_syncing? ? 'disabled' : ''}"
= link_to "Clean up feed", clean_up_resource_path(@resource.username), class: "btn btn-default #{@resource.currently_syncing? ? 'disabled' : ''}"
= link_to "Clear all", sync_clear_path(@resource.username), class: "btn btn-default #{@resource.currently_syncing? ? 'disabled' : ''}"

- if @tasks.count > 0
  %h3 Active Tasks
  .tasks
    - @tasks.each do |task|
      .well
        = render 'tasks/task', task: task

.row
  .col-md-6
    %h2
      %a{'data-toggle' => 'collapse', 'data-target' => "\#res-group-basic"} Basic Data
    %section#res-group-basic.collapse
      %p
        %b ID:
        = @resource.id
      %p
        %b Name:
        = @resource.name
      %p
        %b Username:
        = @resource.username
      %p
        %b Facebook ID:
        = @resource.facebook_id
      %p
        %b Link:
        =link_to @resource.link, @resource.link
      %p
        %b Last synced:
        = @resource.last_synced.localtime if @resource.last_synced.is_a?(Time)
        = link_to(clear_last_synced_path(@resource), method: :patch, title: 'Clear this field') do
          %span.glyphicon.glyphicon-trash
      %p
        %b Active:
        = @resource.active
      = link_to 'Edit', edit_resource_path(@resource)
      %p
        %em Note that this edit functionality is not well supported.
  .col-md-6
    %h2
      %a{'data-toggle' => 'collapse', 'data-target' => "\#res-group-about"} Additional Data
    %section#res-group-about.collapse
      - @basicdata.each do |item|
        %p
          %b= item['key']
          = item['value']
      %p
        = simple_form_for(@keywords, url: keywords_path(@resource), method: :patch) do |f|
          = f.error_notification
          = f.input :key, as: :hidden
          = f.input :value, as: :string, label: 'Modify keywords (comma seperated)'
          = f.button :submit, 'Save', class: 'btn-default'


%h2 
  %a{'data-toggle' => 'collapse', 'data-target' => "\#res-group-metrics"} Metrics
.row#res-group-metrics
  .col-md-6
    %h3 Resource Metrics
    = link_to "Re-Calc", run_metrics_path(@resource.username), method: :patch, class: "btn btn-default"
    %ul
    - @metrics.each do |class_name, group|
      %li= render "metrics/#{class_name}", collection: group, klass: Metrics::ModelHelper.make_klass(class_name).set(group)

  .col-md-6
    %h3 Group Metrics
    %em.text-muted updating of group metrics can be done on the group page
    - @resource.resource_groups.each do |group|
      = link_to group.group_name, resource_group_details_path(group)
    %ul  
      - @group_metrics.each do |class_name, group|
        %li= render "metrics/#{class_name}", collection: group, klass: Metrics::ModelHelper.make_klass(class_name).set(group)

    = form_tag(add_resource_to_group_path(@resource)) do
      .form-group
        %label{for: 'resource_resource_groups'}
          Add to group:
        = collection_select(:resource, :resource_groups, @all_groups, :id, :group_name, {}, {:class => 'form-control'})
      %button.btn.btn-default{type: 'submit'} Add



%h2 Feed
= "Total Items #{@filter_count}"
.filter
  %ul.nav.nav-pills
    %li
      %span Filter:
    %li= link_to 'All (but comments)', resource_details_path(@resource.username, 0)
    %li= link_to 'Posts', resource_details_path(@resource.username, 0, f: "message")
    %li= link_to 'Stories', resource_details_path(@resource.username, 0, f: "story")
    %li= link_to 'Comments', resource_details_path(@resource.username, 0, f: "comment")

= render 'resources/feeds_paging', offset: @offset, username: @resource.username, filter: @filter, total_pages: @total_pages

%table.table.feed-table
  %tr
    %th.col-date Date
    %th.col-data Data
    %th.col-type Type
    %th.col-from From
    %th.col-to To
    %th.col-comments Comments
    %th.col-likes Likes
  - @feeds.each do |item|
    %tr
      %td.col-date= item['updated_time'].localtime.to_formatted_s(:long)
      %td.col-data
        .res-data= item['data']
      %td.col-type= item['feed_type']
      %td.col-from
        - if !item.from.nil?
          = link_to item.from.name, resource_details_path(item.from.username)
      %td.col-to
        - if !item.to.nil?
          = link_to item.to.name, resource_details_path(item.to.username)
      %td.col-comments= item['comment_count']
      %td.col-likes= item['like_count']

= render 'resources/feeds_paging', offset: @offset, username: @resource.username, filter: @filter, total_pages: @total_pages